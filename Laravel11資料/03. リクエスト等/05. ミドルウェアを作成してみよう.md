ミドルウェアは、自作する事もできますので、自作して適用してみましょう。ここでは、入力値で、name=gonbe という値がある場合、権兵衛さんに挨拶する画面を表示するようにしてみます。

```bash
php artisan make:middleware HelloGonbe
```

基本テンプレート
```php
public function handle(Request $request, Closure $next): Response
{
    // $request を使って、ここで前処理の具体的な処理を書く


    $response = $next($request);

    // $response を使って、ここで後処理の具体的な処理を書く


    return $response;
}
```

app/Http/Middleware/HelloGonbe.php
```php
class HelloGonbe
{
    public function handle(Request $request, Closure $next): Response
    {
        if ($request->input('name') === 'gonbe') {
            return response('Hello 権兵衛さん！');
        }

        return $next($request);
    }
}
```

### ミドルウェアを適用する
#### ルートレベルで適用
上記のミドルウェアをルートレベルで適用させるには、以下のように記述します。

web.php
```php
use App\Http\Middleware\HelloGonbe;

Route::get('/', function (Request $request) {
	// 処理

})->middleware(HelloGonbe::class);
```

#### グループレベルで適用
グループレベルに適用する場合は、以下のように記述します。なお、この `bootstrap/app.php` に対して記述するのは、Laravel 11 以降の書き方になります。

bootstrap/app.php
```php
use App\Http\Middleware\HelloGonbe;

    ->withMiddleware(function (Middleware $middleware) {
        $middleware->appendToGroup('web', [
            HelloGonbe::class,
        ]);
    })
```

`appendToGroup('web'` として、`web` グループに対して追加しています。`appendToGroup` の代わりに `prependToGroup` のメソッドを使うこともでき、その場合は、既存の `web` グループの最初に追加します。（実行される順番が最初になります）

ショートカットで、下記のような `web` メソッドを使う事もできます。

```php
    $middleware->web(append: [
        HelloGonbe::class,
    ]);
```

#### グローバルに適用
グローバルに適用する場合は、以下のように記述します。

```php
    $middleware->append(HelloGonbe::class);
```
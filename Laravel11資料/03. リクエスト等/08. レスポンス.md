ドキュメント：[本家サイト](https://laravel.com/docs/11.x/responses) [日本語](https://readouble.com/laravel/11.x/ja/responses.html)

ミドルウェアの所でも見たようにレスポンスは、ユーザー（ブラウザ）に返されるデータ（情報）です。基本は、コントローラから返されたデータがレスポンスとなります。既に `view` 関数を使った view を返す方法は見ましたが、他にも「リダイレクト」「JSONデータ」「ダウンロード指示」などを返す事ができます。1つ1つ見て行きましょう。

## view
テンプレートファイルを指定して、view データ（通常は、HTML）を返します。
同じ事をやるにしても幾つかの方法があります。

```php
// 第1引数にテンプレートファイル
// 第2引数にテンプレートに引き渡すデータ
return view('hello', ['name' => '権兵衛']);

// with を使った方法
return view('hello')->with('name', '権兵衛');

// コンテンツを直接指定
return response('Hello World !');
return response('Hello World !', 403); // ステータスコード付き

// ヘッダーなども制御
return response()
	->view('hello', ['name' => '権兵衛'], 200)
	->header('X-My-Header', 'abcd1234');
```

## リダイレクト
POST 送信の後は、リダイレクト処理をするのが良いとされています。なぜなら、リダイレクトしない場合、データが登録等された後に、ユーザーがブラウザの「更新」ボタンを押すと、「フォームの再送信の確認」などの確認画面が表示され、ユーザーが OK ボタンを押すと、再度、登録処理のリクエストが送られてしまうからです。それを避ける為に、POST 送信の後は、リダイレクトを行うのが一般的です。

```php
return redirect('url');             // URL を直接指定
return redirect(route('login'));    // ルート名を利用
return redirect()->route('login');  // 同上
return to_route('login');           // 同上

// フラッシュデータも指定
return redirect('home')->with('status', '登録しました');

// back() ヘルパ関数を使って、直前の URL にリダイレクト
return back();
```

## JSON データ
Laravel では、配列やデータベースから取得した Eloquent データをそのまま返すと、適宜、JSONデータに変換した上で出力してくれます。ただ、必要以上にデータを露出しないよう、適宜項目を制限して出力すると良いでしょう。

```php
$user = User::find(1);

return $user;  // これだけでユーザーのデータが JSON で出力される

// 項目を制限
return response()
	->json([
		'name' => $user->name,
		'email' => $user->email,
	]);

// DB をリフレッシュしてダミーデータを登録するコマンド
php artisan migrate:fresh --seed
```

本講座では扱いませんが、上記のような場合、 [Eloquent: API Resources](https://laravel.com/docs/11.x/eloquent-resources) を使う方法もあります。

## ダウンロード
特定のファイルやコンテンツをダウンロードさせる方法です。

### ダウンロード

```php
// ブラウザにダウンロードさせる
return response()->download($pathToFile);
return response()->download($pathToFile, $name, $headers);

// ブラウザに直接表示
return response()->file($pathToFile);
return response()->file(base_path('composer.json')); // 例
```

### ストリームダウンロード

ダウンロードするファイルの全中身をメモリに読み込むと、メモリの使用量が増えてエラーになったり、処理が遅くなったりします。そんな時は、このストリームダウンロードを使うようにします（生成した CSV をダウンロードさせる場合に使ったりします）。

```php
// 構文
return response()->streamDownload($callback, $filename, $headers);

// 例
$callback = function () {
	readfile(base_path('composer.json'));
};
return response()->streamDownload($callback, 'composer.json', ['Content-Type' => 'application/json']);
```

### Storage を利用したダウンロード
（後に見る）Storage を利用してダウンロードすることもできます。

```php
use Illuminate\Support\Facades\Storage;

return Storage::download($pathToFile, $name, $headers);
```

この場合のファイルパスは、各 Storage で管理するルートを起点とした相対パスになります。
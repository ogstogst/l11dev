ドキュメント：[本家サイト](https://laravel.com/docs/11.x/filesystem#file-uploads) [日本語](https://readouble.com/laravel/11.x/ja/filesystem.html#file-uploads)

Storage の基礎は分かりましたので、ファイルのアップロード処理を見て行きます。「CRUD 作成」の所でブログの新規登録を見ましたが、そこで画像をアップロードできるようにしましょう。
なお、Storage には、アップロードされたファイルを保存する専用のメソッドがありますが、（`Storage::putFile` or `Storage::putFileAs` ）ここでは代わりの方法を使って行きます。ブログのフォーム画面に以下を追加します。

views/member/posts/create.blade.php
```html
<form ... enctype="multipart/form-data">

<p>
<label>画像</label>
<input type="file" name="eyecatch">
</p>
```

PostManageController の中身を以下のように変更します。

```php
    public function store(Request $request)
    {
        $data = $request->validate([
            'title' => ['required', 'string', 'max:255'],
            'body' => ['required', 'string'],
            'eyecatch' => ['nullable', 'mimes:jpeg,png,gif'],
        ]);

        if ($request->hasFile('eyecatch')) {
            // 第1引数は、格納するフォルダ名
            // 第2引数は、使用するディスク名
            // 生成されたファイル名がパス（フォルダ名）付きで返ってくるので、
            // それをそのまま DB に保存する。
            // 例） posts/vp7r9fefeujse6ifd18KdS.png
            $data['eyecatch'] = $request->file('eyecatch')->store('posts', 'public');
        }

        auth()->user()->posts()->create($data);

        return to_route('member.posts.index')->with('status', 'ブログを新規登録しました');
    }
```

以上で、アップロードされた画像は、`storage/app/public/posts/` 以下のフォルダに格納されます。また、DB の `eyecatch` 項目にファイルのパスが格納されます。

では、一覧画面で画像が登録されている時は、その画像を表示するようにしてみましょう。以下のように一覧画面を変更します。（やや強引ですが、タイトルの横に表示します）

views/member/posts/index.blade.php
```php
    @foreach($posts as $post)
        <tr>
            <td>
                {{ $post->title }}
                @if($post->eyecatch)
                    <img src="{{ Storage::url($post->eyecatch) }}" style="width:100px">
                @endif
            </td>
```

これで、画像が登録されている時は、一覧画面にも表示されるようになりました。

（本来、変更画面で画像も変更できるようにすべきですが、ここでは割愛させていただきます）
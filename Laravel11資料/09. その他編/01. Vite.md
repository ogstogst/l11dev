ドキュメント：[本家サイト](https://laravel.com/docs/11.x/vite) [日本語](https://readouble.com/laravel/11.x/ja/vite.html)

フロントエンドの開発時に必要とされる Vite を見て行きます。Vite とは高速で動作するフロントエンドのビルドツールです。TypeScript や Sass ファイルのコンパイル（トランスパイル）や分割したファイル（モジュール）の結合＆圧縮（バンドル）を行ってくれます。また、ホットリロード機能により、ファイルの更新を検知してブラウザを自動で更新してくれます。（ここでのコンパイルとは、最新技術を使って書いたコードをブラウザが解釈できるように変換する事を言います）

### Vite を使用する上での必要なツール
- Node.js … サーバサイドで JavaScript を使えるようにする実行環境。（Ver.16 以降が必要）
- npm … Node.js のパッケージを管理するツール（Node Package Manager）

バージョンの確認
```php
node -v
npm -v

# Laravel Sail の場合
sail node -v
sail npm -v
```

Node.js： https://nodejs.org/

Windows / macOS では、上記にインストーラあり。（Node.js をインストールすると npm も同時にインストールされます）
wsl (ubuntu) では、標準のインストールだと古いバージョンがインストールされる為、下記でインストールして下さい。

[Debian and Ubuntu based Linux distributions](https://nodejs.org/en/download/package-manager#debian-and-ubuntu-based-linux-distributions)
他、参考
[UbuntuへのNode.jsのインストール](https://zenn.dev/toyonobu/articles/20230121-node-install-for-ubuntu)
[Node.js を Linux 用 Windows サブシステム (WSL2) にインストールする](https://learn.microsoft.com/ja-jp/windows/dev-environment/javascript/nodejs-on-wsl)

### Vite のインストールと実行
npm コマンドを使ってインストールします。npm の管理ファイルの `package.json` には、Vite をパッケージとしてインストールするよう記述がありますので、以下のコマンドを実行すれば、Vite がインストールされます。

```bash
npm install

# Laravel Sail の場合
sail npm install
```

（もし Laravel Breeze を導入している場合は、既に Vite はインストールされています）

### Vite で CSS と JS の読み込み指定
Vite で管理する CSS と JS を読み込む指定をします。会員用のレイアウトファイルに、下記を追加します。

views/layouts/member.blade.php
```html
<!DOCTYPE html>
<html>
<head>
// 略

@vite(['resources/css/app.css', 'resources/js/app.js'])
</head>
```

デフォルトでは、上記の `resources/css/app.css` と `resources/js/app.js` のファイルが Vite で管理される事となる為、上記のように記述します。

### Vite を実行する
開発中は、以下のコマンドを実行して Vite を実行します。

```bash
npm run dev
```

これで、Vite が実行中となり、ホットリロード機能も有効となります。止める時は、Ctrl + C（Command + C）を押します。
（`php artisan serve` コマンドとは別物ですので、これはこれで必要に応じて別途実行して下さい）

#### ホットリロード機能が有効にならない場合
WSL2 で Sail を使われていてもし動作しない場合、vite の設定ファイルに下記を追記して試してみて下さい。（`server` のブロック）

vite.config.js
```js
export default defineConfig({
    plugins: [
        laravel({
            input: ['resources/css/app.css', 'resources/js/app.js'],
            refresh: true,
        }),
    ],
	server: {
        host: 'localhost',
	},
});

```

以下もご確認下さい。
- 設定ファイルを変更したら、もう一度、npm run dev して、一度手動でブラウザを更新してみる。
- 上記の `refresh: true,` となっているのを確認する。
- 対象の view ファイルで `@vite(['resources/css/app.css', 'resources/js/app.js'])` を書き忘れていないか確認する。
- 広告ブロック機能を外す。

上記でもダメな場合、polling の設定を試してみて下さい。

vite.config.js
```js
    server: {
        // 略
        watch: {
          usePolling: true,
        },
    },
```

又は下記設定も試してみて下さい。

vite.config.js
```js
// 略

const host = 'localhost';

export default defineConfig({
    plugins: [
        laravel({
            // 略
        }),
    ],
    server: {
        host,
        hmr: { host },
    },
});
```

HTTPS 接続の場合、[ドキュメント](https://readouble.com/laravel/11.x/ja/vite.html#working-with-a-secure-development-server)も確認して下さい。

### 開発が終わり本番にデプロイする際
本番にデプロイする際には、以下のコマンドを実行し、ビルドを実行します。

```bash
npm run build
```

すると、`public/build` 以下の場所に `manifest.json`、`assets/app.xxx.js`、`assets/app.xxx.css` ファイルが出力されますので、これらのファイルも本番サーバにデプロイします。

xxx は、ビルドする都度にランダムな値に変わります。これは、ファイルのキャッシュ対策です。（ユーザーが古いファイルを読まないようにファイル名を変更する）
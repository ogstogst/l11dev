ドキュメント：[本家サイト](https://laravel.com/docs/11.x/migrations) [日本語](https://readouble.com/laravel/11.x/ja/migrations.html)

マイグレーションは、ファイル名の日時の新しい順に実行されます。ファイル内には、`up` と `down` のメソッドがあり、`up` がマイグレーション実行用です。`down` は実行されたマイグレーションを取り消す（ロールバック）為のものです。

## ブログ投稿用のテーブルを作成
ブログ投稿用のテーブルを作成しましょう。

### 新規テーブル作成
以下のコマンドを実行してマイグレーションファイルを作成します。

```bash
php artisan make:migration create_posts_table
```

database/migrations/2024_xx_xxxxxx_create_posts_table.php
```php
Schema::create('posts', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained();
    $table->string('title');
    $table->longText('body');
    $table->string('eyecatch')->nullable();
    $table->timestamps();
});
```

### テーブルに項目を追加
後でテーブルに項目を追加する際などは以下のようにします。

```bash
php artisan make:migration add_is_public_to_posts
```

database/migrations/2024_xx_xx_xxxxxx_add_is_public_to_posts.php
```php
public function up(): void
{
    Schema::table('posts', function (Blueprint $table) {
        $table->boolean('is_public')->default(true);
    });
}

public function down(): void
{
    Schema::table('posts', function (Blueprint $table) {
        $table->dropColumn('is_public');
    });
}
```

### down メソッドについて
`down` メソッドは、実行されたマイグレーションを取り消す（ロールバック）為のものです。

ただ、開発者の中には、`down` メソッドは使わない（書かない）という人も居る事は知っておいて損は無いかもしれません。
[Do we still need Down migrations? Taylor says No.](https://laraveldaily.com/post/still-need-migrations-taylor-says-no)
Tailor さんの理由は、
- 何か問題が起きたら、前に戻るのではなく、問題を修正するための新しいマイグレーションを書いて前進をすべき。

## マイグレーション用コマンド色々
### 覚えるべきコマンド
```bash
php artisan migrate               # 未実行のマイグレーションを実行する
php artisan migrate:fresh         # DB 内に存在するテーブルを全て削除してから、migrate
php artisan migrate:fresh --seed  # シーディングもついでに行う
```

### 実際はあまり使わないコマンド
```php
php artisan migrate:rollback  # 最後の1回分をロールバック
php artisan migrate:rollback --step=2 # 2回分ロールバック
php artisan migrate:reset  # 全てロールバック
php artisan migrate:refresh  # reset してから、migrate
php artisan migrate:status   # マイグレーション状況の確認
```

ロールバックは、`down` メソッドを呼び出して、ロールバックします。

データベースを再構築する場合、refresh より fresh の方が効率が良いので（各 down メソッドを呼び出さないので）、特に理由が無い限りは、fresh を使うようにしましょう。
（DB 内に他の案件のテーブルが共存している場合、そちらも含めて削除しますのでご注意下さい。普通はあり得ないですが）

（fresh は、refresh の効率の悪さを改善する為に、Laravel 5.5 で登場しました）
（覚え方：refresh より fresh の方が文字数が少ない分、実行時間も短い）

### 注意事項
当然の事ながら、本番サーバで、fresh などを実行すると、データが消えてしまいますので、ご注意下さい。
`.env` ファイルで、`APP_ENV=production` と設定している場合は、警告（確認画面）が表示されます。
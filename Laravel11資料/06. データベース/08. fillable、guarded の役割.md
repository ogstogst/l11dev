ドキュメント：[本家サイト](https://laravel.com/docs/11.x/eloquent#mass-assignment) [日本語](https://readouble.com/laravel/11.x/ja/eloquent.html#mass-assignment)

`create()`、 `update()`、 `fill()` 等で一括設定（複数代入）する場合、モデルの `$fillable`、`$guarded` プロパティの設定が必要になります。これは、ユーザーから送信されたデータを一括してモデルに設定する際に、悪意のあるユーザーにプログラマの意図しないデータ（項目）を送りつけられて悪さをされないようにする為の機能となります。

未設定状態の時に上記のメソッドで一括設定をすると、`MassAssignmentException` のエラーが発生します。逆に言うと、`MassAssignmentException` のエラーが出た時は、`$fillable` か `$guarded` の設定を忘れたと判断できます。 

`$fillable`、`$guarded` は、どちらか一方のみを指定します。（両方指定はNG）

$fillable … 列挙した項目のみがセットされる（ホワイトリスト）
$guarded … 列挙した項目はセットされない（ブラックリスト）

デフォルトでは、ユーザーが `$fillable` に列挙が無いデータを送りつけてきた時や、`$guarded` に列挙されているデータを送りつけてきた時でも、`MassAssignmentException` のエラーは発生せず、ただ単にそれらはフィルタリング（除外）されて、処理が続けられます。

fillable の場合
```php
    protected $fillable = [
        'name',
        'email',
        'password',
    ];
```

guarded の場合
```php
    protected $guarded = [
        'is_admin',
    ];
```

確認用コード
```php
// ユーザーがこのデータを送ったと想定
$request->merge([
    'name' => 'taro',
    'email' => \Str::random(10).'@exammple.net',
    'password' => 'password',
    'is_admin' => 1,  // ★ fillable に列挙無し
]);

$data = $request->all();
$user = User::create($data);
```

個別にプロパティを設定する以下のようなやり方は、`$fillable`、`$guarded` の設定は不要です（設定は使われない）。
```php
$user = new User();
$user->name = 'taro';
$user->email = \Str::random(10).'@exammple.net';
$user->password = 'password';
$user->save();
```

## で、fillable と guarded 結局どちらを使えば良いの？
基本的には、「使い易い方でどうぞ」となります。
一般的には、ホワイトリストとブラックリストと言うと、ホワイトリストの方が、必要最低限の項目に絞っている為、安全と言われる事が多いです。

但し、以下のような実情もあります。

### fillable
- 設定は1つしかできないので、状況に応じて切り換える事ができなく、結局、意味無いものになりかねない。

### guarded
- 海外などでは、guarded 派も多い。
- そもそも `$request->all()` で取得したデータを直接、登録データに渡すという悪習慣は、昔はあったかも知れないが、現在は Laravel の機能を正しく使えば、そのような事はしないで済む。

現在の Laravel では、バリデーションした際に、バリデーションしたデータのみを取得する事ができます。その時点で、意図しないデータは、ほぼ弾けます。

#### 海外の guarded 派の人達の設定
```php
class User extends Model
{
    protected $guarded = []; // 全ての項目を許可
}
```

## 補足情報
下記のような update の場合、モデルデータを取得する事無く、update の SQL 文が直接実行される為、`$fillable`、`$guarded` の設定は無視されます。

```php
User::where('id', '>', '10')
    ->update(['name' => 'saburo']);
```

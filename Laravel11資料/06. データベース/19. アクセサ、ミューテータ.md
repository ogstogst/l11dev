ドキュメント：[本家サイト](https://laravel.com/docs/11.x/eloquent-mutators) [日本語](https://readouble.com/laravel/11.x/ja/eloquent-mutators.html)

アクセサとミューテータ機能について見て行きます。なお、ここで見る機能は、Laravel Ver.8.77 から導入された新しい方式のものになります。
旧方式の `getXxxxAttribute` などの形式は、最新のドキュメントからは姿を消していますが、現在も使えます。

## アクセサ
モデルの属性を動的に取得できる機能です。データの加工等を行って取得する場合に便利です。
アクセサの作成は、protected のメソッドとし、名前は camelCase にした上で、Attribute を return したメソッドで定義する。（ミューテータも同じ）

例：モデルの名前（name）を表示する際に、自動で「様」を付ける。

Models/User.php
```php
use Illuminate\Database\Eloquent\Casts\Attribute;

class User extends Authenticatable
{
    protected function nameSama(): Attribute
    {
        return Attribute::make(
            get: function () {
                return $this->name.' 様';
            },
            
            // アロー関数を使うと1行で書ける
            // get: fn () => $this->name.' 様',
        );
    }
```

web.php
```php
$user = User::find(1);

dd($user->name_sama);
```

### 補足
下記のようにプロパティ名と同名で定義することも可能です。
```php
    protected function name(): Attribute
    {
        return Attribute::make(
            get: fn ($value) => $value.' 様',
        );
    }
```

特にアクセサにこだわりがなければ、このアクセサ機能を使わず、普通のメソッドを定義して取得しても良いかも知れません。

## ミューテータ
アクセサの逆で、プロパティに設定する際に機能します。

例：名前を保存する際、自動で全角スペースを取り除きたい。

Models/User.php
```php
    protected function name(): Attribute
    {
        return Attribute::make(
            set: function ($value) {
                return str_replace('　', '', $value); // 全角スペースを削除
            },
        );
    }
```

web.php
```php
$user = User::create([
    'name' => '武田　信玄',
    'email' => \Str::random(10).'@exammple.net',
    'password' => \Hash::make('abcd1234'),
]);

dd($user->toArray());
```

## appends（中級）
上記で見たアクセサーは、JSON 出力（シリアライズ）する際は、データとして付加されません。
下記のようにする事で、アクセサも付加されます。

```php
$user = User::find(1);
$user->setAppends(['name_sama']);

return $user;
```

上記のように都度都度ではなく、常に設定する場合は、モデルファイルに以下のように記述します。

Models/User.php
```php
protected $appends = ['name_sama'];
```

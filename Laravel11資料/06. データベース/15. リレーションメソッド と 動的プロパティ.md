ドキュメント：[本家サイト](https://laravel.com/docs/11.x/eloquent-relationships#querying-relations) [日本語](https://readouble.com/laravel/11.x/ja/eloquent-relationships.html#querying-relations)

それでは前回定義したリレーションメソッドを活用して行きましょう。
「メソッド」を定義しましたので、まずは「メソッド」として使って見ましょう。

### リレーションメソッドを直接呼び出す
ユーザーが所有するブログ投稿一覧を取得する場合で考えてみます。

もしリレーションメソッドが無かった場合：
```php
$user = User::find(1);

$posts = Post::where('user_id', $user->id)->get();
```

リレーションメソッドを使った場合：
```php
$user = User::find(1);

$posts = $user->posts()->get();
```

よりシンプルに書けましたね。
では今度は、ブログが所属するユーザーの名前を取得する場合で考えてみます。

もしリレーションメソッドが無かった場合：
```php
$post = Post::find(1);

$name = User::where('id', $post->user_id)->first()->name;
```

リレーションメソッドを使った場合：
```php
$post = Post::find(1);

$name = $post->user()->first()->name;
```

こちらもシンプルに書けましたね。

以上、リレーションメソッドを直接呼び出す方法を見てきましたが、**実際はここで紹介したやり方の場合、下で見る「動的プロパティ」を使います。** 上記のようにリレーションメソッドをメソッドとして直接呼び出すのは、下で見る「動的プロパティ」だと実現できない時や理由がある場合のみ、と覚えおいて下さい。

### 動的プロパティ
PHPでは、定義されていないプロパティに対してデータの読み込み／書き込み等行う時、このプロパティを動的プロパティと言います。そして、Laravel ではリレーションメソッドは、動的プロパティとしても使う事ができます。

上記で見た書き方は、以下のように動的プロパティを使って簡潔に書けます。

```php
$posts = $user->posts()->get();
// ↓ 動的プロパティを使うと
$posts = $user->posts;

$name = $post->user()->first()->name;
// ↓ 動的プロパティを使うと
$name = $post->user->name;
```

また、動的プロパティは、取得済みデータのキャッシュがあれば、そのキャッシュが利用されます。（→ 「N + 1」問題を解決してくれる）

#### 問題
では、問題です。

次の違いは？
```php
$user->posts()->count();
    
$user->post->count();
```

上記は、以下のように考えることができます。
```php
Post::where('user_id', $this->id)->count();
    
Post::where('user_id', $this->id)->get()->count();
```

前者は、DB的にカウントしていますが、後者は、対象のレコードをDBから全件取得してから、PHPでカウントしています。（コレクション用 count() メソッドを使用）。単にカウントするだけなら、DB的にカウントした方が効率が良いので、リレーションメソッドを使った方が良い。


ドキュメント：[本家サイト](https://laravel.com/docs/11.x/validation) [日本語](https://readouble.com/laravel/11.x/ja/validation.html)

ここではよく使うバリデーションのメソッドを列挙しております。
実際は他にも数多くのメソッドがある為、更に詳しくはドキュメントで確認して下さい。

メソッドにパラメータがある時は、「:」の後に続けます。パラメーターが複数ある時は、それらを「,」で連結させる（＝ CSV）。

## よく使うメソッド

### 存在チェック
```php
required … 必須の項目に指定
nullable … 任意の項目に指定
```
他にも required_if など多数のバリエーションがあります。

### 数値
```php
integer                 整数か。`int` も同じ（'+1', '-1' なども通る）
numeric                 数値か。（小数や '1337e0' なども通る）
digits:value            指定の文字数の数値（自然数）か。例）'zip' => ['required', 'digits:7'],
digits_between:min,max  指定文字数の数値か
```

### 長さ
```php
min:value             最小の長さ
max:value             最大の長さ
size:value            指定の長さ
between:min,max       範囲内の長さ
```

データの形式により何の長さを対象とするのか、意味が異なります。
- 文字列の場合 … 文字の長さ（日本語の1文字も1文字）
- 配列の場合 … 配列の数
- ファイルの場合 … ファイルのキロバイト数
- 数値系の時（or `integer` や `numeric` の指定がある時） … 値そのもの

例：ユーザーが、フォームで `123` と入力した場合、データは数値系ではなく、文字列としてやってくるので…。
```php
'xxx' => ['required', 'string', 'max:10'],
// この場合、文字列数は 3 になる為、このバリデーションは通過する（'string' の指定が無くても同じ）

'xxx' => ['required', 'integer', 'max:10'],
// 'integer' の指定がある時は、数値扱いされ 123 は 10 より大きいため、入力エラー。
```

### ファイル、画像
```php
file             正常にアップロードされたファイルか
image            画像か（'jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp' の MIME か）
mimetypes        指定された MIME タイプか
mimes            指定された MIME タイプの右側部分か
extensions       ユーザー提供の拡張子を調べる（単独での使用は、NG）
```

使用例：
```php
'mimetypes:video/mpeg',

指定の画像かチェック
'mimes:jpg,gif,png,webp',    'jpg' の指定があれば、'jpeg' は省いてもOK
```

`image`、`mimetypes`、`mimes` は、実際のファイルの中身をチェックして判定します。
一方、`extensions` は、ファイルの中身まではチェックせず、ユーザーから送られたファイルの拡張子を調べます。
ユーザーが拡張子を偽る恐れもある為、`extensions` を使用する際は、必ず `mimes` などと一緒に使用します。

CSV ファイルは一癖あります。ファイルの中身に依って、`text/plain` や `text/csv` と判定されます。ですので、バリデーションは、`'mimes:csv,txt'` のように2つ指定しておき、後はプログラム側で中身の検証をしましょう。

参考：[MIME タイプ一覧](https://svn.apache.org/repos/asf/httpd/httpd/trunk/docs/conf/mime.types)

### 日付
```php
date                 日付形式か。'2019/1/4' とか '019-01-04' ならOK
date_format:format   format の形式の日付形式か

after:date           指定の date を過ぎた日時か
```

使用例：
```php
'date_format:Y-m-d,Y/m/d'    // カンマ区切りで複数指定できます

'after:tomorrow'             // 明日を過ぎた日時か。PHP がサポートする書式が使えます
'after:another_field'        // 指定の項目名の日時を過ぎた日時か
```

`after` の類似で、`after_or_equal`、`before`、`before_or_equal` もあります。

[サポートする日付と時刻の書式](https://www.php.net/manual/ja/datetime.formats.php)

### メールアドレス
メールアドレスの形式チェックは、`email` です。但し、6つのオプションパラメータが用意されています。例えば、DNS に問い合わせて実在するドメインが存在するかチェックする `dns` などです。（ここでは個々のオプションは見て行きません）

Laravel Breeze では以下のようなメールアドレスチェックをしています。
```php
'email' => ['required', 'string', 'lowercase', 'email', 'max:255'],
```

これでも良いのですが、`'email'` の形式チェックは、日本語も通ります。現在では、メールアドレスに日本語も使えるようになっているからです。ですが、現実問題日本語がメールアドレスに使われているのは、ほぼ皆無と言えます。
そこで、`email:filter` というオプションを付けると、日本語（ascii 文字以外）を弾くことができますので、そのようにすると良いでしょう。

### パスワード
パスワード系でよく使うメソッドを見てみます。
パスワード文字の形式チェック等は、以下を使うと良いでしょう。

```php
use Illuminate\Validation\Rules\Password;
// use Illuminate\Support\Facades\Password; ← こちらではない

Password::min(8)                   // 最小8文字以上
Password::min(8)->letters()        // 文字を含むか
Password::min(8)->mixedCase()      // 大文字と小文字を含むか
Password::min(8)->numbers()        // 数字を含むか
Password::min(8)->symbols()        // 記号を含むか
Password::min(8)->uncompromised()  // パスワードが漏れていないか（外部サービスを呼び出します）

上記メソッドを連結させて指定できます。
```

その他の確認系
```php
confirmed           対応する項目名の xxx_confirmation と同じ値か
current_password    現在リクエストを送信しているユーザーのパスワードと一致するか
```

サンプルコード

パスワード変更画面の HTML
```html
現在のパスワード
<input type="password" name="old_password">

新しいパスワード
<input type="password" name="password">

新しいパスワード（確認）
<input type="password" name="password_confirmation">
```

バリデーション
```php
use Illuminate\Validation\Rules\Password;

'old_password' => ['required', 'string', 'current_password'],
'password' => ['required', 'string', 'confirmed', Password::min(8)->letters()->symbols()],
```

### その他
```php
string               文字列か
url                  URL の形式か
accepted             'yes', 'on', '1', 1, true, 'true' か。（同意のチェックボックス向き）
boolean              true, false, 0, 1, '0', '1' か。（単純なチェックボックス向け）
regex:/regex/        指定の正規表現にマッチするか
array                配列か
in:value,value...    指定の値の内のいずれかか
confirmed            対応する項目名の xxx_confirmation と同じ値か
```

使用例：
```php
'regex:/\A[a-zA-Z0-9]+\z/'    英数字のみから成り立つか（alpha_num:ascii と等価）

// 配列の例
// HTML は、以下と想定。
<input type="checkbox" name="fruits[]" value="apple">
<input type="checkbox" name="fruits[]" value="orange">
<input type="checkbox" name="fruits[]" value="banana">

'fruits' => ['required', 'array'],            // 配列全体へのチェック
'fruits.*' => ['in,apple,orange,banana'],     // 配列個々の要素に対してのチェック
```

### 注意すべきメソッド

```php
alpha          アルファベットのみの文字か
alpha_dash     アルファベットと数字とハイフンとアンダースコアーのみの文字か
alpha_num      アルファベットと数字のみの文字か
```

メソッド名的には、上記の説明で正しいように見えますが、実際は日本語の文字も通ってしまいます…。
この挙動を修正するには、`:ascii` パラメータを付加して下さい。（Ver.9.49～）

```php
`alpha:ascii`,
`alpha_dash:ascii`,
`alpha_num:ascii`,
```

### DB 系
#### ユニーク（重複しない）かチェック
ログインIDやメールアドレスなど、DB 内にある他のデータと重複しないかをチェックします。

```php
use Illuminate\Validation\Rule;

'email' => [Rule::unique('users')],
'email' => [Rule::unique('users')->ignore($user->id)],  // 指定ユーザーのIDを除く（更新の場合など）

// クラス名やモデルを直接指定することも可能です
'email' => [Rule::unique(User::class)->ignore($user)],
```